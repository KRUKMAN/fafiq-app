sequenceDiagram
  participant User
  participant App
  participant Session as SessionStore
  participant Storage as Supabase Storage
  participant DB as Supabase (Postgres)

  User->>App: open dog detail (Documents tab)
  App->>Session: bootstrap (auth + memberships, org selection)
  Note over Session: Uses last_org_id + active membership
  User->>App: press "Upload sample document"
  App->>Storage: uploadDocument(org_id, "dog", dog_id, file)
  Storage-->>App: path/key stored in bucket
  App->>DB: insert public.documents (org_id, entity_type, entity_id, storage_path, filename, mime_type)
  DB-->>App: document row created (audit trigger logs activity)
  App-->>User: show upload status + add file to list
  User->>App: open document
  App->>Storage: createSignedUrl(documents, path)
  Storage-->>App: signed URL
  App-->>User: opens/downloads in external viewer
