flowchart TD
  subgraph UI["Calendar UI (React Query + filters)"]
    CAL[Calendar screen\nFilters + Add Event]
  end

  subgraph DB["Supabase (RLS org-scoped)"]
    CE[(calendar_events)]
    REM[(calendar_reminders)]
    TASKS[(tasks)]
    DOGS[(dogs)]
    MED[(medical_records)]
    TRANS[(transports)]
    ORGSETTINGS[(orgs.settings\nquarantine_days)]
    RPC["RPC: get_calendar_events\nfilters: range, source_type[], dog, contact, stage, visibility, search"]
  end

  CAL -->|React Query fetch| RPC
  CAL -->|createCalendarEvent (manual)| CE
  CAL -->|createTask| TASKS
  CE --> REM
  RPC --> CAL

  DOGS --> RPC
  MED --> RPC
  TRANS --> RPC
  TASKS --> RPC
  ORGSETTINGS --> RPC

  CE -. reminders .-> RPC
  CE -. manual artifacts .-> RPC
  TASKS -. projected as task events .-> RPC
  DOGS -. quarantine projection .-> RPC
